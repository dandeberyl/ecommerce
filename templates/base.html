<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}E-commerce{% endblock %}</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
    <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap" rel="stylesheet">
</head>

<body class="flex flex-col min-h-screen bg-gray-50 text-gray-900">

    <nav class="bg-purple-900 text-white">
        <div class="container mx-auto flex items-center justify-between p-10">
            <a href="{% url 'home' %}" class="text-3xl font-bold"
                style="font-family: 'Great Vibes', cursive;">MyStore</a>

            <ul class="flex space-x-6">
                <li>
                    <a href="{% url 'home' %}"
                        class="text-xl {% if request.resolver_match.url_name == 'home' %}text-yellow-400 font-bold{% else %}hover:text-yellow-400{% endif %}">
                        Home
                    </a>
                </li>

                <li>
                    <a href="{% url 'product_list' %}"
                        class="text-xl {% if request.resolver_match.url_name == 'product_list' %}text-yellow-400 font-bold{% else %}hover:text-yellow-400{% endif %}">
                        Category
                    </a>
                </li>

                <li>
                    <a href="{% url 'view_cart' %}"
                        class="{% if request.resolver_match.url_name == 'view_cart' %}text-yellow-400 font-bold{% else %}hover:text-yellow-400{% endif %} text-xl">
                        Cart (<span id="cart-count">{{ cart_items_count|default:0 }}</span>)
                    </a>
                </li>

                <li>
                    <a href="{% url 'profile' %}"
                        class="text-xl {% if request.resolver_match.url_name == 'profile' %}text-yellow-400 font-bold{% else %}hover:underline{% endif %}">
                        {{ user.username }}
                    </a>
                </li>

            </ul>
        </div>
    </nav>

    <main class="container mx-auto flex-1 p-6">
        {% block content %}
        {% endblock %}
    </main>

    <footer class="bg-purple-900 text-center py-4 mt-6">
        <p class="text-sm text-white" style="font-family: 'Great Vibes', cursive;">&copy; {{ now|date:"Y" }} MyStore.
            All rights reserved.</p>
    </footer>


    <script>
        document.addEventListener("DOMContentLoaded", function () {
            document.querySelectorAll(".add-to-cart-form").forEach(form => {
                form.addEventListener("submit", function (e) {
                    e.preventDefault();

                    fetch(form.action, {
                        method: "POST",
                        body: new FormData(form)
                    })
                        .then(res => res.json())
                        .then(data => {
                            if (data.success) {
                                const cartCount = document.querySelector("#cart-count");
                                if (cartCount) {
                                    cartCount.textContent = data.cart_item_count;
                                }
                                console.log("Added to cart!");
                            }
                        })
                        .catch(err => console.error("Error:", err));
                });
            });
        });
    </script>

</body>

</html>